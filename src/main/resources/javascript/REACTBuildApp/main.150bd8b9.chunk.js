(this["webpackJsonpwiden-picker"]=this["webpackJsonpwiden-picker"]||[]).push([[0],{138:function(e,a,t){"use strict";t.r(a);var n=t(34),r=t(0),c=t.n(r),s=t(23),l=t.n(s),o=(t(79),t(9)),i=t.n(o),u=t(13),d=t.p+"modules/widen-picker/icons/loader_4.d2f7f41c.gif",E=(t(81),t(19)),h=t.n(E),m=t(145),p=t(146),f=t(61),g=c.a.createContext(null),T=t(147),R=t(142),b=t(62),v=t(7),O=function(e){var a=c.a.useContext(g),t=a.state,n=a.dispatch,r=t.isLoading,s=function(){var e=Object(u.a)(i.a.mark((function e(a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.preventDefault(),n({case:"EXECUTE_QUERY"});case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return c.a.createElement(T.a,{className:"pT4__form",onSubmit:s},c.a.createElement(T.a.Group,{controlId:"basicSearch"},c.a.createElement(R.a,{className:"mb-3"},c.a.createElement(T.a.Control,{type:"text",name:"query",onChange:function(e){var a=e.target.value;n({case:"UPDATE_TEXT_QUERY",payload:{searchQuery:a}})},placeholder:"Que cherchez-vous ?"}),c.a.createElement(R.a.Append,null,c.a.createElement(b.a,{type:"reset",variant:"outline-secondary",disabled:r,onClick:function(e){n({case:"RESET_TEXT_QUERY"})}},c.a.createElement(v.a,{icon:["fas","times"]}))),c.a.createElement(R.a.Append,null,c.a.createElement(b.a,{type:"submit",variant:"secondary",disabled:r},c.a.createElement(v.a,{icon:["fas","search"]})))),c.a.createElement(T.a.Text,{className:"text-muted"},c.a.createElement(v.a,{icon:["fas","power-off"]})," by Jahia For Widen")))},_=t(11),P=t(148),y=function(e){var a=e.item,t=c.a.useContext(g),n=t.state,r=t.dispatch,s=n.selectedItem,l=a.thumbnails,o=a.created_date,i=a.filename,u=a.id,d=a.embeds,E=h()(l,"160px.url",null),m=h()(d,"templated.url",null),p=new Date(o);p=p.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});var f=s.id===u?"active":"";return c.a.createElement(P.a,{className:f,onClick:function(){return r({case:"UPDATE_SELECTED_ITEM",payload:{id:u,url:m}})}},E&&c.a.createElement(P.a.Img,{variant:"top",src:E}),c.a.createElement(P.a.Body,null,c.a.createElement(P.a.Title,null,i)),c.a.createElement(P.a.Footer,{className:"text-center"},p))},S=(t(143),t(6)),x=function(e){var a=e.searchResultPerPage;return{offset:(e.searchResultPageIndex-1)*a,limit:a}},w=function(e){var a=e.searchSortBy,t=e.searchSortByDirection,n=e.searchSortListDirection.filter((function(e){return e.value===t})),r=Object(_.a)(n,1)[0];return{sort:"".concat(r.symbol).concat(a)}},j=function(){var e=Object(u.a)(i.a.mark((function e(a){var t,n,r,c,s,l,o,u,d,E,m,p,f;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.path,n=void 0===t?"/":t,r=a.state,c=a.dispatch,s=r.widenEngine,l=r.searchQuery,r.searchFacets,r.searchFilters,o=r.searchResultPerPage,u=r.searchResultPageIndex,d=r.searchSortBy,E=r.searchSortByDirection,m=r.searchSortListDirection,c({case:"LOADING",payload:{value:!0}}),p=Object(S.a)(Object(S.a)({query:l,expand:"embeds,thumbnails,file_properties"},x({searchResultPerPage:o,searchResultPageIndex:u})),w({searchSortBy:d,searchSortByDirection:E,searchSortListDirection:m})),e.prev=4,e.next=7,s(n,{params:p});case 7:f=e.sent,c({case:"UPDATE_SEARCH_RESULTS",payload:{searchResults:h()(f,"data",{})}}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),c({case:"ERROR",payload:{error:e.t0}});case 14:c({case:"LOADING",payload:{value:!1}});case 15:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(a){return e.apply(this,arguments)}}(),A=function(e){var a=e.index,t=c.a.useContext(g),n=t.state,r=t.dispatch,s=n.searchResultPageIndex===a?"active":"";return c.a.createElement("li",null,c.a.createElement("a",{href:"#",className:s,onClick:function(e){e.preventDefault(),r({case:"GOTO_RESULT_PAGE",payload:{index:a}})}},a))},I=function(){var e=c.a.useContext(g).state.searchResultMaxPage;return c.a.createElement(c.a.Fragment,null,Object(n.a)(Array(e)).map((function(e,a){return c.a.createElement(A,{key:a,index:a+1})})))},D=function(){var e,a=c.a.useContext(g).state,t=a.searchResultPageIndex,n=a.searchResultMaxPage,r=t>3,s=n-t>2;switch(!0){case t<=2:e=[2,3];break;case n-t>1:e=[t-1,t,t+1];break;case n-t===1:e=[t-1,t];break;default:e=[t-2,t-1]}return c.a.createElement(c.a.Fragment,null,c.a.createElement(A,{index:1}),r&&c.a.createElement("li",{className:"interlayer"},c.a.createElement(v.a,{icon:["fas","ellipsis-h"]})),e.map((function(e,a){return c.a.createElement(A,{key:a,index:e})})),s&&c.a.createElement("li",{className:"interlayer"},c.a.createElement(v.a,{icon:["fas","ellipsis-h"]})),c.a.createElement(A,{index:n}))},L=function(){var e=c.a.useContext(g),a=e.state,t=e.dispatch,n=a.searchResultPerPage;return c.a.createElement("li",null,c.a.createElement(R.a,null,c.a.createElement(R.a.Prepend,null,c.a.createElement(R.a.Text,{id:"inputGroupPrepend"},c.a.createElement(v.a,{icon:["far","file-alt"]}))),c.a.createElement(T.a.Control,{as:"select",defaultValue:n,onChange:function(e){t({case:"UPDATE_RESULT_PER_PAGE",payload:{value:e.target.value}})},title:"Result per page"},[5,10,20,50,100].map((function(e){return c.a.createElement("option",{key:e,value:e},e)})))))},k=function(){var e=c.a.useContext(g),a=e.state,t=e.dispatch,n=a.isLoading,r=a.searchResultPageIndex,s=a.searchResultMaxPage,l=c.a.useState(r),o=Object(_.a)(l,2),i=o[0],u=o[1];c.a.useEffect((function(){u(r)}),[r]);return c.a.createElement("li",null,c.a.createElement(T.a,{className:"pT4__form-goto",onSubmit:function(e){e.preventDefault(),s<i||t({case:"GOTO_RESULT_PAGE",payload:{index:i}})}},c.a.createElement(R.a,null,c.a.createElement(R.a.Prepend,null,c.a.createElement(R.a.Text,{id:"inputGroupPrepend"},c.a.createElement(v.a,{icon:["far","paper-plane"]}))),c.a.createElement(T.a.Control,{type:"text",name:"paging",value:i,onChange:function(e){u(e.target.value)},title:"Goto Page"}),c.a.createElement(R.a.Append,null,c.a.createElement(b.a,{type:"submit",variant:"outline-secondary",disabled:n},c.a.createElement(v.a,{icon:["fas","sync-alt"]}))))))},U=t(144),C=t(72);function F(e,a){var t="";a.indexOf("a")>-1&&(t+="abcdefghijklmnopqrstuvwxyz"),a.indexOf("A")>-1&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),a.indexOf("#")>-1&&(t+="0123456789"),a.indexOf("!")>-1&&(t+="~`!@#$%^&*()_+-={}[]:\";'<>?,./|\\");for(var n="",r=e;r>0;--r)n+=t[Math.floor(Math.random()*t.length)];return n}var G=function(){var e=c.a.useContext(g),a=e.state,t=e.dispatch,n=a.searchSortBy,r=a.searchSortByDirection,s=a.searchSortList,l=a.searchSortListDirection,o=s.filter((function(e){return e.value===n})),i=Object(_.a)(o,1)[0],u=l.filter((function(e){return e.value===r})),d=Object(_.a)(u,1)[0],E=function(e){var a=e.target.id;t({case:"UPDATE_SORT_ITEM",payload:{sortBy:a}})};return c.a.createElement(c.a.Fragment,null,c.a.createElement("li",null,c.a.createElement(U.a,{alignRight:!0,variant:"outline-dark",title:"Sort by ".concat(i.label),id:"sortBy_".concat(F(6,"aA#"))},s.map((function(e,a){return c.a.createElement(C.a.Item,{key:a,id:e.value,onClick:E},e.label)})))),c.a.createElement("li",null,c.a.createElement(b.a,{variant:"outline-dark",onClick:function(e){return t({case:"TOGGLE_SORT_DIRECTION"})}},c.a.createElement(v.a,{icon:["fas",d.label]}))))},N=function(e){var a=c.a.useContext(g),t=a.state,n=a.dispatch,r=(t.searchResultPerPage,t.searchResultMaxPage),s=t.searchResultAvailableAnswersCount,l=r>10;if(!r)return c.a.createElement(c.a.Fragment,null);return c.a.createElement(c.a.Fragment,null,c.a.createElement("ul",{className:"pT4__paging results"},c.a.createElement("li",{className:"results"},c.a.createElement("h6",null,"R\xe9sultats : ",s)),c.a.createElement(G,null),c.a.createElement(L,null),l&&c.a.createElement(k,null)),c.a.createElement("ul",{className:"pT4__paging"},c.a.createElement("li",{className:"nav"},c.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),n({case:"PREVIOUS_RESULT_PAGE"})}},c.a.createElement(v.a,{icon:["fas","chevron-left"]}))),r<=5&&c.a.createElement(I,null),r>5&&c.a.createElement(D,null),c.a.createElement("li",{className:"nav"},c.a.createElement("a",{href:"#",onClick:function(e){e.preventDefault(),n({case:"NEXT_RESULT_PAGE"})}},c.a.createElement(v.a,{icon:["fas","chevron-right"]})))))},B=(t(88),t(24)),M=t(69),Q=t(10),q=t(17);B.b.add(M.a,Q.i,Q.h,q.b,q.e,Q.a,Q.m,Q.n,Q.o,q.f,q.a,Q.d,Q.b,Q.c,Q.g,Q.e,Q.f,q.c,Q.l,q.d,Q.j,Q.k);var z=function(e){var a=e.e;return c.a.createElement(c.a.Fragment,null,c.a.createElement("h1",null,"Oups something get wrong"),c.a.createElement("p",null,a.message))},X=function(e){var a=c.a.useContext(g),t=a.state,n=a.dispatch,r=(t.context,t.error),s=t.isLoading,l=t.searchAnswers,o=(t.searchIframe,t.searchFacets,t.needToFetch);return c.a.useEffect((function(){o&&function(){var e=Object(u.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j({path:"/assets/search",state:t,dispatch:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[o]),r?c.a.createElement(z,{e:r}):c.a.createElement(m.a,{className:"pT4"},c.a.createElement(p.a,null,c.a.createElement(f.a,null,c.a.createElement(O,null),c.a.createElement(N,null))),c.a.createElement(p.a,null,c.a.createElement(f.a,null,s&&c.a.createElement("img",{className:"pT4__spinner",src:d}),!s&&c.a.createElement("div",{className:"pT4__result ".concat(s?"":"fade-in")},l.map((function(e){return c.a.createElement(y,{key:e.id,item:e,locale:t.locale})})))),c.a.createElement(f.a,{xs:"4",sm:"3",md:"4",lg:"3"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var W=function(e){var a=e.item,t=e.errors;return c.a.createElement("div",null,c.a.createElement("h1",null,"Validation errors"),c.a.createElement("p",null,"An error occurred when validating ",c.a.createElement("b",null,a)),c.a.createElement("ul",null,t.map((function(e,a){return c.a.createElement("li",null,e.dataPath," : ",e.message)}))))},Y=t(70),$={context:{title:"context validation schema ",description:"context is an object provided by the page in charge to load the app",type:"object",properties:{host:{type:"string",format:"uri",default:"http://localhost:8080"},workspace:{type:"string",enum:["default","live"],default:"live"},scope:{type:"string",pattern:"[a-zA-Z0-9-_]+",default:"lamode"},widen:{type:"object",properties:{url:{type:"string",format:"uri",default:"https://api.widencollective.com"},site:{type:"string",default:"virbac"},token:{type:"string",default:"ba4d0a71907a17aff9ebddc1fc91fd3a"},version:{type:"string",default:"v2"},lazyLoad:{type:"boolean",default:JSON.parse("false")},resultPerPage:{type:"integer",default:Number.parseInt("20",10)},mountPoint:{type:"string",default:"/sites/systemsite/contents/widen"}},required:["url","site","token","version","lazyLoad","resultPerPage","mountPoint"],additionalProperties:!1},gql_endpoint:{type:"string",format:"uri",default:"http://localhost:8080/modules/graphql"},gql_authorization:{type:"string",default:"Basic cm9vdDpyb290"}},required:["host","workspace","scope","widen","gql_endpoint","gql_authorization"],additionalProperties:!1}},V=new Y({useDefaults:!0}),J=t(42),H=t.n(J),Z=function(e){var a=H.a.create({baseURL:"".concat(e.widen.url,"/").concat(e.widen.version),headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(e.widen.site,"/").concat(e.widen.token)},responseType:"json",timeout:6e3}),t=H.a.create({baseURL:e.gql_endpoint,headers:{Authorization:e.gql_authorization},responseType:"json",timeout:3e3}),n=e.widen,r=n.lazyLoad,c=n.resultPerPage;return{context:e,error:null,isLoading:!1,needToFetch:!r,selectedItem:{},widenEngine:a,mountPoint:n.mountPoint,graphQLEngine:t,searchAnswers:[],searchIframe:null,searchSortBy:"created_date",searchSortByDirection:"DESC",searchSortList:[{value:"created_date",label:"Date Added"},{value:"last_update_date",label:"Date Updated"},{value:"filename",label:"Filename"},{value:"file_format",label:"File Format"},{value:"file_size",label:"File Size"}],searchSortListDirection:[{value:"ASC",label:"sort-amount-up",symbol:""},{value:"DESC",label:"sort-amount-down",symbol:"-"}],searchQuery:null,searchFacets:[],searchFilters:[],searchBanners:[],searchResultPerPage:Number.parseInt(c,10),searchResultMaxPage:null,searchResultPageIndex:1,searchResultAvailableAnswersCount:null}},K=function(e,a){var t=a.payload;switch(a.case){case"UPDATE_TEXT_QUERY":return console.debug("[STORE] UPDATE_TEXT_QUERY - query: ",t.searchQuery),Object(S.a)(Object(S.a)({},e),{},{searchQuery:t.searchQuery});case"RESET_TEXT_QUERY":return console.debug("[STORE] RESET_TEXT_QUERY"),Object(S.a)(Object(S.a)({},e),{},{searchQuery:"",needToFetch:!0});case"EXECUTE_QUERY":return console.debug("[STORE] EXECUTE_QUERY"),Object(S.a)(Object(S.a)({},e),{},{searchResultPageIndex:1,needToFetch:!0});case"UPDATE_SELECTED_ITEM":var n=t.id,r=e.graphQLEngine;e.mountPoint;return console.debug("[STORE] UPDATE_SELECTED_ITEM - payload: ",t),function(){var a=Object(u.a)(i.a.mark((function a(){var t,c,s,l;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return"query getWiden($workspace: Workspace!,$path: String!){\n                                  response: jcr(workspace: $workspace) {\n                                    node:nodeByPath(path:$path){\n                                      uuid\n                                    }\n                                  }\n                                }",t={workspace:"EDIT",path:"".concat(e.mountPoint,"/").concat(n)},c={query:"query getWiden($workspace: Workspace!,$path: String!){\n                                  response: jcr(workspace: $workspace) {\n                                    node:nodeByPath(path:$path){\n                                      uuid\n                                    }\n                                  }\n                                }",variables:t},a.prev=3,a.next=6,r.post("",c);case 6:s=a.sent,l=s.data.data.response.node.uuid,console.log("jContent uuid is generated : ",l),a.next=14;break;case 11:a.prev=11,a.t0=a.catch(3),console.error("oups ! something wrong with graphQL : ",a.t0);case 14:case"end":return a.stop()}}),a,null,[[3,11]])})));return function(){return a.apply(this,arguments)}}()().then((function(){console.log("[STORE] UPDATE_SELECTED_ITEM - window.widenPickerInterface: ",window.widenPickerInterface),window.widenPickerInterface.add("".concat(e.mountPoint,"/").concat(n)),console.log("[STORE] UPDATE_SELECTED_ITEM - window.widenPickerInterface.data: ",window.widenPickerInterface.data)})),Object(S.a)(Object(S.a)({},e),{},{selectedItem:t});case"UPDATE_SEARCH_RESULTS":console.debug("[STORE] UPDATE_SEARCH_RESULTS - searchResults: ",t.searchResults);var c=t.searchResults,s=c.items,l=c.total_count,o=e.searchResultPerPage,d=e.searchResultPageIndex,E=e.searchResultMaxPage,h=l;return 1===d&&(E=Math.ceil(h/o)),Object(S.a)(Object(S.a)({},e),{},{searchAnswers:s,searchResultAvailableAnswersCount:h,searchResultMaxPage:E,needToFetch:!1});case"TOGGLE_FILTER":var m=t.filter;console.debug("[STORE] TOGGLE_ANSWER -> filter id :",m.id);var p=e.searchFacets.reduce((function(e,a,t){return a.id===m.type&&(e=[a,t]),e}),[]),f=Object(_.a)(p,2),g=f[0],T=f[1],R=g.list.map((function(e){return e.id===m.id?Object(S.a)(Object(S.a)({},e),{},{selected:!e.selected}):e}));g=Object(S.a)(Object(S.a)({},g),{},{list:R});var b=e.searchFacets.slice();return b.splice(T,1,g),console.debug("[STORE] searchFacets :",b),Object(S.a)(Object(S.a)({},e),{},{searchFacets:b,searchResultPageIndex:1,needToFetch:!0});case"REMOVE_FILTER":var v=t.filter;console.debug("[STORE] REMOVE_FILTER -> filter id :",v.id);var O=e.searchFacets.filter((function(e){return e.id!==v.id}));console.debug("[STORE] searchFacets :",O);var P=e.searchFilters.filter((function(e){return e.id!==v.id}));return Object(S.a)(Object(S.a)({},e),{},{searchFacets:O,searchFilters:P,searchResultPageIndex:1,needToFetch:!0});case"ERROR":return console.debug("[STORE] ERROR - searchResults: ",t.error),Object(S.a)(Object(S.a)({},e),{},{error:t.error});case"LOADING":return console.debug("[STORE] LOADING - value: ",t.value),Object(S.a)(Object(S.a)({},e),{},{isLoading:t.value});case"PREVIOUS_RESULT_PAGE":if(console.debug("[STORE] PREVIOUS_RESULT_PAGE"),e.searchResultPageIndex<=1)return Object(S.a)({},e);var y=e.searchResultPageIndex-1;return Object(S.a)(Object(S.a)({},e),{},{needToFetch:!0,searchResultPageIndex:y});case"NEXT_RESULT_PAGE":console.debug("[STORE] NEXT_RESULT_PAGE");var x=e.searchResultMaxPage;if(e.searchResultPageIndex>=x)return Object(S.a)({},e);var w=e.searchResultPageIndex+1;return Object(S.a)(Object(S.a)({},e),{},{needToFetch:!0,searchResultPageIndex:w});case"GOTO_RESULT_PAGE":console.debug("[STORE] GOTO_RESULT_PAGE payload : ",t);var j=Number(t.index),A=e.searchResultMaxPage;return!j||j<1||j>A?Object(S.a)({},e):Object(S.a)(Object(S.a)({},e),{},{needToFetch:!0,searchResultPageIndex:j});case"UPDATE_RESULT_PER_PAGE":console.debug("[STORE] UPDATE_RESULT_PER_PAGE payload : ",t);var I=t.value;return Object(S.a)(Object(S.a)({},e),{},{searchResultPerPage:I,searchResultPageIndex:1,needToFetch:!0});case"UPDATE_SORT_ITEM":console.debug("[STORE] UPDATE_SORT_ITEM payload : ",t);var D=t.sortBy;return Object(S.a)(Object(S.a)({},e),{},{searchSortBy:D,needToFetch:!0});case"TOGGLE_SORT_DIRECTION":console.debug("[STORE] TOGGLE_SORT_DIRECTION");var L=e.searchSortByDirection,k=e.searchSortListDirection.filter((function(e){return e.value!=L})),U=Object(_.a)(k,1)[0];return Object(S.a)(Object(S.a)({},e),{},{searchSortByDirection:U.value,needToFetch:!0});default:return Object(S.a)(Object(S.a)({},e),{},{error:new Error("[STORE] action case '".concat(a.case,"' is unknown "))})}},ee=function(e){var a=c.a.useReducer(K,e.context,Z),t=Object(_.a)(a,2),n=t[0],r=t[1];return c.a.createElement(g.Provider,{value:{state:n,dispatch:r}},e.children)},ae={_context:{},_data:[],get context(){return this._context},get data(){return this._data},set context(e){this._context=e},set data(e){this._data=e},load:function(e){console.log(e.d),void 0!==e.d&&Array.isArray(e.d)&&(ae.data=Array.from(e.d))},add:function(e,a){return this.data=[].concat(Object(n.a)(this.data),[e]),this.data},remove:function(e){this.data=this.data.filter((function(a){return!a.endsWith(e)}))},removeAt:function(e){return-1!==e?(this.data=this.data.splice(e,1),this.data):null},removeAll:function(){ae.data=[]}};window.widenPicker=function(e,a){try{a=function(e){if(!V.validate($.context,e))throw{item:"Context configuration object",errors:V.errors};return e}(a);l.a.render(c.a.createElement(ee,{context:a},c.a.createElement(X,null)),document.getElementById(e))}catch(t){console.error("error : ",t),l.a.render(c.a.createElement(W,{item:t.item,errors:t.errors}),document.getElementById(e))}},window.widenPickerInterface=ae,"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},79:function(e,a,t){},81:function(e,a,t){}},[[138,1,2]]]);
//# sourceMappingURL=main.150bd8b9.chunk.js.map